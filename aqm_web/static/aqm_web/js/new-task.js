// Generated by CoffeeScript 1.3.1
(function() {
  var get_float, reset_domain_modal, show_lambert_fields, show_latlon_fields, show_location_fields, show_map_modal, show_mercator_fields, show_polar_fields, show_preview_map;

  $(document).ready(function() {
    $('#ntf-proj').change(function(e) {
      var proj;
      e.preventDefault();
      proj = $('#ntf-proj').val();
      return show_location_fields(proj);
    });
    show_location_fields($('#ntf-proj').val());
    $('#btn-map-preview').click(function(e) {
      var latitude, longitude, true_lat;
      e.preventDefault();
      latitude = get_float('#ntf-ref-lat', '#ntf-ref-container');
      longitude = get_float('#ntf-ref-lon', '#ntf-ref-container');
      if (isNaN(latitude) || isNaN(longitude)) {

      } else {
        true_lat = Math.abs(latitude);
        if (isNaN(get_float('#ntf-true-lat1'))) {
          $('#ntf-true-lat1').val(true_lat);
        }
        return show_preview_map(latitude, longitude);
      }
    });
    $('#btn-area-modal-close').click(function(e) {
      e.preventDefault();
      return $('#area-modal').modal('hide');
    });
    $('#area-modal').on('hidden', function() {
      return spinner_func.spinner_stop('#map-loading-spinner');
    });
    $('#btn-add-domain').click(function(e) {
      e.preventDefault();
      reset_domain_modal();
      return $('#domain-modal').modal('show');
    });
    $('#btn-domain-modal-cancel').click(function(e) {
      e.preventDefault();
      return $('#domain-modal').modal('hide');
    });
    return $('#btn-domain-modal-ok').click(function(e) {
      e.preventDefault();
      return $('#domain-modal').modal('hide');
    });
  });

  reset_domain_modal = function() {
    var title;
    title = 'Add New Domain';
    $('#domain-modal .clearfix').removeClass('error');
    $('#domain-modal .input-prepend').removeClass('error');
    $('#domain-modal .modal-header h3').text(title);
    $('#ntf-dom-name').val('');
    $('#ntf-dom-id').val('');
    $('#ntf-dom-width').val('');
    $('#ntf-dom-height').val('');
    $('#ntf-dom-dx').val('');
    $('#ntf-dom-dy').val('');
    $('#ntf-ratio').val('');
    $('#ntf-dom-parent-start-i').val('');
    return $('#ntf-dom-parent-start-j').val('');
  };

  show_preview_map = function(latitude, longitude) {
    var lower_lat, lower_lon, map_url, true_lat, upper_lat, upper_lon;
    true_lat = Math.abs(latitude);
    upper_lat = latitude + 20;
    upper_lon = longitude + 27;
    lower_lat = latitude - 20;
    lower_lon = longitude - 27;
    if (upper_lat > 80) {
      upper_lat = 80;
      lower_lat = 80 - 40;
    }
    if (lower_lat < -80) {
      lower_lat = -80;
      upper_lat = -80 + 40;
    }
    map_url = "" + window.aqm.map_mercator_base_url + "?upper_lat=" + upper_lat + "&upper_lon=" + upper_lon + "&lower_lat=" + lower_lat + "&lower_lon=" + lower_lon + "&true_lat=" + true_lat + "&ref_lat=" + latitude + "&ref_lon=" + longitude;
    return show_map_modal(map_url);
  };

  show_map_modal = function(map_url) {
    spinner_func.spinner_play('#map-loading-spinner');
    $('#area-modal .preview-image').hide().load(function() {
      return $(this).fadeIn();
    }).attr('src', map_url);
    return $('#area-modal').modal('show');
  };

  get_float = function(source, container) {
    var val;
    if (container == null) {
      container = '';
    }
    val = parseFloat($(source).val());
    if (isNaN(val)) {
      $(container).addClass('error');
    } else {
      $(container).removeClass('error');
    }
    return val;
  };

  show_location_fields = function(projection) {
    switch (projection) {
      case "mercator":
        return show_mercator_fields();
      case "lambert":
        return show_lambert_fields();
      case "polar":
        return show_polar_fields();
      case "lat-lon":
        return show_latlon_fields();
    }
  };

  show_mercator_fields = function() {
    console.log("mercator selected");
    $('#ntf-true-lat1-cont').show();
    $('#ntf-true-lat2-cont').hide();
    $('#ntf-stand-lon-cont').hide();
    $('#ntf-pole-lat-cont').hide();
    return $('#ntf-pole-lon-cont').hide();
  };

  show_lambert_fields = function() {
    console.log("lambert selected");
    $('#ntf-true-lat1-cont').show();
    $('#ntf-true-lat2-cont').show();
    $('#ntf-stand-lon-cont').show();
    $('#ntf-pole-lat-cont').hide();
    return $('#ntf-pole-lon-cont').hide();
  };

  show_polar_fields = function() {
    console.log("polar selected");
    $('#ntf-true-lat1-cont').show();
    $('#ntf-true-lat2-cont').hide();
    $('#ntf-stand-lon-cont').show();
    $('#ntf-pole-lat-cont').hide();
    return $('#ntf-pole-lon-cont').hide();
  };

  show_latlon_fields = function() {
    console.log("lat-lon selected");
    $('#ntf-true-lat1-cont').hide();
    $('#ntf-true-lat2-cont').hide();
    $('#ntf-stand-lon-cont').show();
    $('#ntf-pole-lat-cont').show();
    return $('#ntf-pole-lon-cont').show();
  };

}).call(this);
